# taxpool-sim

## ä½¿ç”¨è¯´æ˜

1. **å…‹éš†ä»“åº“**

```bash
git clone https://github.com/acciomerlin/taxpool-sim.git
cd taxpool-sim
```

2. **å‡†å¤‡æ•°æ®æ–‡ä»¶**

ç”±äº Git LFS é™é¢ï¼Œ`filtered_transactions_11000k.csv` è¿™ä¸ªåªåŒ…å«éåˆçº¦äº¤æ˜“çš„æ•°æ®é›†æ— æ³•ä¸Šä¼ ï¼Œæˆ‘æ”¾åˆ°é£ä¹¦äº†ï¼š

<img src="assets/image-20250620010813053.png" alt="image-20250620010813053" style="zoom:33%;" />

æ”¾åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼š

```
./filtered_transactions_11000k.csv
```

3. **è¿è¡Œæ¨¡æ‹Ÿå™¨**

åœ¨ IDE ä¸­æ‰“å¼€æœ¬é¡¹ç›®ï¼ˆå¦‚ GoLandï¼‰ï¼Œç›´æ¥è¿è¡Œ `main.go` æˆ–ä½¿ç”¨å‘½ä»¤è¡Œï¼š

```bash
go build -o taxsim main.go
./taxsim
```

å‡ ç§’åå°†çœ‹åˆ°æ§åˆ¶å°æ‰“å°ç±»ä¼¼å¦‚ä¸‹ä¿¡æ¯ï¼š

```bash
ğŸ“Š æ­£åœ¨è¯»å–äº¤æ˜“ï¼šå·²è¯»å– 299308 / 3607054 (8.30%)ï¼Œè€—æ—¶ 2.00 ç§’
ğŸ“Š æ­£åœ¨è¯»å–äº¤æ˜“ï¼šå·²è¯»å– 589658 / 3607054 (16.35%)ï¼Œè€—æ—¶ 4.00 ç§’
...
ğŸ“Š æ­£åœ¨è¯»å–äº¤æ˜“ï¼šå·²è¯»å– 3391123 / 3607054 (94.01%)ï¼Œè€—æ—¶ 20.00 ç§’

Process finished with the exit code 0
```

è¿è¡Œå®Œæ¯•åå°†ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

```
 outputCSV/
  â””â”€â”€ shard_20250620_010344.csv    # å‡ºå—ç»Ÿè®¡æ•°æ®ï¼ŒæŒ‰æ—¶é—´æˆ³å‘½å

 exp.log                          # æ—¥å¿—æ–‡ä»¶ï¼ˆè®°å½•æ‰“åŒ…æµç¨‹ã€å»¶è¿Ÿç­‰ä¿¡æ¯ï¼‰
```

------

4. **ç»˜å›¾åˆ†æ**

ä½¿ç”¨ Python è„šæœ¬ `draw.py` è¿›è¡Œç»“æœå¯è§†åŒ–

```bash
pip install pandas matplotlib  //å¦‚æœæ²¡è£…
```

ç„¶åä¿®æ”¹ `draw.py` ä¸­çš„è·¯å¾„ï¼š

```python
df = pd.read_csv("outputCSV/shard_20250620_010344.csv")  # æ›¿æ¢ä¸ºä½ ç”Ÿæˆçš„ CSV æ–‡ä»¶å
```

æ‰§è¡Œç»˜å›¾è„šæœ¬ï¼š

```bash
python draw.py
```

è¾“å‡ºå›¾ä¿å­˜åœ¨ï¼š

```
output_plots/
â””â”€â”€ shard0_overview_m3.png
```

å›¾ä¸­å°†å±•ç¤º Tax/Subsidy ã€f_itx_min&f_ctx_minã€balance/delta balanceï¼Œå…¶ä»–çš„block emulatorçš„ç»˜å›¾ä»£ç æˆ‘å…ˆæ³¨é‡Šæ‰äº†ï¼Œä»£ç æ”¾åœ¨figureplot/ä¸‹é¢ã€‚

## é¡¹ç›®ç»“æ„æ¦‚è§ˆ

```

taxpool_sim/
â”œâ”€â”€ main.go               // ä¸»ç¨‹åºå…¥å£ï¼šå¯åŠ¨è¯»å–ã€æ‰“åŒ…ã€å†™å‡ºä¸‰å¤§åç¨‹
â”œâ”€â”€ txpool.go             // TxPool äº¤æ˜“æ± ç»“æ„å®šä¹‰ä¸æ‰“åŒ…é€»è¾‘
â”œâ”€â”€ taxpool.go            // TaxPool ç»“æ„å®šä¹‰ä¸åŠ¨æ€è°ƒèŠ‚ç®—æ³•ï¼ˆv1/v2/v3/v3.2ï¼‰
â”œâ”€â”€ transaction.go        // äº¤æ˜“ç»“æ„
â”œâ”€â”€ utils.go              // è¾…åŠ©å‡½æ•°ï¼Œå¦‚ Addr2Shardã€isCtx ç­‰
â”œâ”€â”€ outputCSV/            // å‡ºå—ç»Ÿè®¡ä¿¡æ¯è¾“å‡ºç›®å½•
â”œâ”€â”€ exp.log               // æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ filtered_transactions_11000k.csv // é¢„å¤„ç†äº¤æ˜“æ•°æ®æ–‡ä»¶ï¼ˆæ¨¡æ‹Ÿäº¤æ˜“ï¼‰
â””â”€â”€ draw.py               // Python å¯è§†åŒ–è„šæœ¬
```

